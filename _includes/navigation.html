<nav class="relative">
  <ul class="flex space-x-6">
    {% for item in site.data.navigation.main %}
      <li class="group relative">
        <a href="{{ item.url }}" class="flex items-center px-3 py-2">
          {{ item.title }}
          {% if item.submenu %}
            <i class="fas fa-caret-down ml-1"></i>
          {% endif %}
        </a>
        
        {% assign sub_items = "" %}
        {% if item.url == '/services' %}
          {% assign sub_items = site.services | sort: 'order' %}
          {% assign sub_sub_items = site['sub-services'] | sort: 'order' %}
        {% elsif item.url == '/industries' %}
          {% assign sub_items = site.industries | sort: 'order' %}
          {% assign sub_sub_items = site['sub-industries'] | sort: 'order' %}
        {% endif %}
        
        {% if sub_items != "" %}
          <div class="absolute left-0 top-full w-full bg-white shadow-lg mt-2 hidden group-hover:block">
            <div class="w-full px-4 py-6 grid grid-cols-4 gap-6">
              {% for sub in sub_items %}
                <div class="col-span-1"> <!-- Added div to control width based on grid column -->
                  <a href="{{ sub.url | relative_url }}" class="block w-full">
                    <h3 class="text-lg font-semibold text-gray-800">{{ sub.title }}</h3>
                    <ul class="mt-2">
                      {% assign nested_items = "" %}
                      {% if item.url == '/services' %}
                        {% assign nested_items = sub_sub_items | where: "parent", sub.title %}
                      {% elsif item.url == '/industries' %}
                        {% assign nested_items = sub_sub_items | where: "parent", sub.title %}
                      {% endif %}
                      {% for nested in nested_items %}
                        <li>
                            {{ nested.title }}
                        </li>
                      {% endfor %}
                    </ul>
                  </a>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</nav>